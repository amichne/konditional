{"schemaVersion":1,"snippetId":"golden-path","codeHash":"6f5e9dc0559ac314d1579cb8c63269201446202348df949ee7a1f8ab6e0fe639","language":"kotlin","code":"// File: src/main/kotlin/com/example/GoldenPath.kt\npackage com.example\n\nimport io.amichne.konditional.context.*\nimport io.amichne.konditional.core.Namespace\nimport io.amichne.konditional.core.dsl.boolean\nimport io.amichne.konditional.core.dsl.enum\nimport io.amichne.konditional.api.evaluate\nimport io.amichne.konditional.api.explain\n\n// Step 1: Define types for typed features\nenum class CheckoutVariant { CLASSIC, FAST_PATH, EXPERIMENTAL }\n\n// Step 2: Create namespace (feature registry)\nobject AppFeatures : Namespace(\"app\") {\n\n    // Boolean feature with platform targeting\n    val darkMode by boolean<Context>(default = false) {\n        rule(true) {\n            platforms(Platform.IOS)\n            note(\"iOS users get dark mode\")\n        }\n        rule(true) {\n            rampUp { 10.0 }\n            note(\"10% gradual rollout to everyone\")\n        }\n    }\n\n    // Enum feature with multiple variants\n    val checkoutVariant by enum<CheckoutVariant, Context>(\n        default = CheckoutVariant.CLASSIC\n    ) {\n        rule(CheckoutVariant.FAST_PATH) {\n            platforms(Platform.IOS)\n            versions { min(2, 0, 0) }\n            rampUp { 25.0 }\n            note(\"iOS 2.0+ users, 25% rollout\")\n        }\n        rule(CheckoutVariant.EXPERIMENTAL) {\n            platforms(Platform.ANDROID)\n            rampUp { 5.0 }\n            note(\"Android users, 5% rollout\")\n        }\n    }\n}\n\n// Step 3: Build contexts from runtime data\nfun buildContext(userId: String, platform: Platform, version: Version): Context {\n    return Context(\n        locale = AppLocale.UNITED_STATES,\n        platform = platform,\n        appVersion = version,\n        stableId = StableId.of(userId)\n    )\n}\n\n// Step 4: Evaluate features\nfun main() {\n    // iOS user on v2.1.0\n    val iosUserCtx = buildContext(\n        userId = \"user-123\",\n        platform = Platform.IOS,\n        version = Version.of(2, 1, 0)\n    )\n\n    // Evaluation returns typed values (never null)\n    val darkModeEnabled: Boolean = AppFeatures.darkMode.evaluate(iosUserCtx)\n    val checkoutVariant: CheckoutVariant = AppFeatures.checkoutVariant.evaluate(iosUserCtx)\n\n    println(\"iOS User:\")\n    println(\"  Dark mode: $darkModeEnabled\")           // true (platform match)\n    println(\"  Checkout: $checkoutVariant\")            // FAST_PATH or CLASSIC (25% ramp)\n\n    // Android user on v1.5.0\n    val androidUserCtx = buildContext(\n        userId = \"user-456\",\n        platform = Platform.ANDROID,\n        version = Version.of(1, 5, 0)\n    )\n\n    val darkModeAndroid = AppFeatures.darkMode.evaluate(androidUserCtx)\n    val checkoutAndroid = AppFeatures.checkoutVariant.evaluate(androidUserCtx)\n\n    println(\"\\nAndroid User:\")\n    println(\"  Dark mode: $darkModeAndroid\")           // false or true (10% ramp)\n    println(\"  Checkout: $checkoutAndroid\")            // EXPERIMENTAL or CLASSIC (5% ramp)\n\n    // Step 5: Debugging with explain()\n    val result = AppFeatures.darkMode.explain(iosUserCtx)\n    println(\"\\nDebug iOS dark mode:\")\n    println(\"  Value: ${result.value}\")\n    println(\"  Decision: ${result.decision}\")\n    result.bucketInfo?.let {\n        println(\"  Bucket: ${it.bucket} (threshold: ${it.percentage}%)\")\n    }\n}\n\n","hovers":[]}