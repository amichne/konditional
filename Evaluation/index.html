
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Type-safe, deterministic feature flags for Kotlin" name="description"/>
<link href="https://amichne.github.io/konditional/Evaluation/" rel="canonical"/>
<link href="../Features/" rel="prev"/>
<link href="../Results/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.22" name="generator"/>
<title>Evaluation - Konditional</title>
<link href="../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#evaluation-flag-evaluation-mechanics">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Konditional" class="md-header__button md-logo" data-md-component="logo" href=".." title="Konditional">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Konditional
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Evaluation
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/amichne/konditional" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    amichne/konditional
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../QuickStart/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
          
  
  
  Core Concepts

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../Configuration/">
          
  
  
  Guides

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Konditional" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Konditional">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Konditional
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/amichne/konditional" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    amichne/konditional
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../QuickStart/">
<span class="md-ellipsis">
    Quick Start
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Features/">
<span class="md-ellipsis">
    Features
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Core Concepts
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Core Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Evaluation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Evaluation
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-methods">
<span class="md-ellipsis">
      Evaluation Methods
    </span>
</a>
<nav aria-label="Evaluation Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluatesafe-explicit-error-handling">
<span class="md-ellipsis">
      evaluateSafe() - Explicit Error Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluateornull-nullable-fallback">
<span class="md-ellipsis">
      evaluateOrNull() - Nullable Fallback
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluateordefault-default-value-fallback">
<span class="md-ellipsis">
      evaluateOrDefault() - Default Value Fallback
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluateorthrow-exception-based">
<span class="md-ellipsis">
      evaluateOrThrow() - Exception-Based
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-flow">
<span class="md-ellipsis">
      Evaluation Flow
    </span>
</a>
<nav aria-label="Evaluation Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-breakdown">
<span class="md-ellipsis">
      Step-by-Step Breakdown
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rule-matching-logic">
<span class="md-ellipsis">
      Rule Matching Logic
    </span>
</a>
<nav aria-label="Rule Matching Logic" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#base-matching">
<span class="md-ellipsis">
      Base Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extension-matching">
<span class="md-ellipsis">
      Extension Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rollout-matching">
<span class="md-ellipsis">
      Rollout Matching
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#specificity-ordering">
<span class="md-ellipsis">
      Specificity Ordering
    </span>
</a>
<nav aria-label="Specificity Ordering" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#specificity-calculation">
<span class="md-ellipsis">
      Specificity Calculation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#specificity-examples">
<span class="md-ellipsis">
      Specificity Examples
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-order-visualization">
<span class="md-ellipsis">
      Evaluation Order Visualization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rollout-bucketing-algorithm">
<span class="md-ellipsis">
      Rollout Bucketing Algorithm
    </span>
</a>
<nav aria-label="Rollout Bucketing Algorithm" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#algorithm">
<span class="md-ellipsis">
      Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bucketing-properties">
<span class="md-ellipsis">
      Bucketing Properties
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#granularity">
<span class="md-ellipsis">
      Granularity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#edge-cases">
<span class="md-ellipsis">
      Edge Cases
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-safety-guarantees">
<span class="md-ellipsis">
      Type Safety Guarantees
    </span>
</a>
<nav aria-label="Type Safety Guarantees" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#compile-time-type-safety">
<span class="md-ellipsis">
      Compile-Time Type Safety
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#runtime-type-safety">
<span class="md-ellipsis">
      Runtime Type Safety
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-characteristics">
<span class="md-ellipsis">
      Performance Characteristics
    </span>
</a>
<nav aria-label="Performance Characteristics" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#time-complexity">
<span class="md-ellipsis">
      Time Complexity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#space-complexity">
<span class="md-ellipsis">
      Space Complexity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concurrency-performance">
<span class="md-ellipsis">
      Concurrency Performance
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-safety">
<span class="md-ellipsis">
      Thread Safety
    </span>
</a>
<nav aria-label="Thread Safety" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#lock-free-reads">
<span class="md-ellipsis">
      Lock-Free Reads
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#atomic-updates">
<span class="md-ellipsis">
      Atomic Updates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#independent-evaluations">
<span class="md-ellipsis">
      Independent Evaluations
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-evaluation">
<span class="md-ellipsis">
      Testing Evaluation
    </span>
</a>
<nav aria-label="Testing Evaluation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-testing-rules">
<span class="md-ellipsis">
      Unit Testing Rules
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-rollouts">
<span class="md-ellipsis">
      Testing Rollouts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-determinism">
<span class="md-ellipsis">
      Testing Determinism
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-specificity-order">
<span class="md-ellipsis">
      Testing Specificity Order
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#best-practices">
<span class="md-ellipsis">
      Best Practices
    </span>
</a>
<nav aria-label="Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#choose-the-right-evaluation-method">
<span class="md-ellipsis">
      Choose the Right Evaluation Method
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#keep-rule-count-low">
<span class="md-ellipsis">
      Keep Rule Count Low
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-specificity-to-your-advantage">
<span class="md-ellipsis">
      Use Specificity to Your Advantage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cache-contexts-when-possible">
<span class="md-ellipsis">
      Cache Contexts When Possible
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#test-rollout-distributions">
<span class="md-ellipsis">
      Test Rollout Distributions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#document-complex-rules">
<span class="md-ellipsis">
      Document Complex Rules
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#examples">
<span class="md-ellipsis">
      Examples
    </span>
</a>
<nav aria-label="Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example-1-simple-boolean-flag">
<span class="md-ellipsis">
      Example 1: Simple Boolean Flag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-2-multi-rule-configuration">
<span class="md-ellipsis">
      Example 2: Multi-Rule Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-3-gradual-rollout-strategy">
<span class="md-ellipsis">
      Example 3: Gradual Rollout Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-4-custom-context-extension">
<span class="md-ellipsis">
      Example 4: Custom Context Extension
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-5-ab-testing">
<span class="md-ellipsis">
      Example 5: A/B Testing
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary-evaluation-guarantees">
<span class="md-ellipsis">
      Summary: Evaluation Guarantees
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Results/">
<span class="md-ellipsis">
    Results
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Guides
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../Configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Context/">
<span class="md-ellipsis">
    Context System
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Rules/">
<span class="md-ellipsis">
    Rules Engine
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Registry/">
<span class="md-ellipsis">
    Registry
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Serialization/">
<span class="md-ellipsis">
    Serialization
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-methods">
<span class="md-ellipsis">
      Evaluation Methods
    </span>
</a>
<nav aria-label="Evaluation Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluatesafe-explicit-error-handling">
<span class="md-ellipsis">
      evaluateSafe() - Explicit Error Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluateornull-nullable-fallback">
<span class="md-ellipsis">
      evaluateOrNull() - Nullable Fallback
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluateordefault-default-value-fallback">
<span class="md-ellipsis">
      evaluateOrDefault() - Default Value Fallback
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluateorthrow-exception-based">
<span class="md-ellipsis">
      evaluateOrThrow() - Exception-Based
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-flow">
<span class="md-ellipsis">
      Evaluation Flow
    </span>
</a>
<nav aria-label="Evaluation Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-breakdown">
<span class="md-ellipsis">
      Step-by-Step Breakdown
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rule-matching-logic">
<span class="md-ellipsis">
      Rule Matching Logic
    </span>
</a>
<nav aria-label="Rule Matching Logic" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#base-matching">
<span class="md-ellipsis">
      Base Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extension-matching">
<span class="md-ellipsis">
      Extension Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rollout-matching">
<span class="md-ellipsis">
      Rollout Matching
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#specificity-ordering">
<span class="md-ellipsis">
      Specificity Ordering
    </span>
</a>
<nav aria-label="Specificity Ordering" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#specificity-calculation">
<span class="md-ellipsis">
      Specificity Calculation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#specificity-examples">
<span class="md-ellipsis">
      Specificity Examples
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-order-visualization">
<span class="md-ellipsis">
      Evaluation Order Visualization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rollout-bucketing-algorithm">
<span class="md-ellipsis">
      Rollout Bucketing Algorithm
    </span>
</a>
<nav aria-label="Rollout Bucketing Algorithm" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#algorithm">
<span class="md-ellipsis">
      Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bucketing-properties">
<span class="md-ellipsis">
      Bucketing Properties
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#granularity">
<span class="md-ellipsis">
      Granularity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#edge-cases">
<span class="md-ellipsis">
      Edge Cases
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-safety-guarantees">
<span class="md-ellipsis">
      Type Safety Guarantees
    </span>
</a>
<nav aria-label="Type Safety Guarantees" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#compile-time-type-safety">
<span class="md-ellipsis">
      Compile-Time Type Safety
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#runtime-type-safety">
<span class="md-ellipsis">
      Runtime Type Safety
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-characteristics">
<span class="md-ellipsis">
      Performance Characteristics
    </span>
</a>
<nav aria-label="Performance Characteristics" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#time-complexity">
<span class="md-ellipsis">
      Time Complexity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#space-complexity">
<span class="md-ellipsis">
      Space Complexity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concurrency-performance">
<span class="md-ellipsis">
      Concurrency Performance
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-safety">
<span class="md-ellipsis">
      Thread Safety
    </span>
</a>
<nav aria-label="Thread Safety" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#lock-free-reads">
<span class="md-ellipsis">
      Lock-Free Reads
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#atomic-updates">
<span class="md-ellipsis">
      Atomic Updates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#independent-evaluations">
<span class="md-ellipsis">
      Independent Evaluations
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-evaluation">
<span class="md-ellipsis">
      Testing Evaluation
    </span>
</a>
<nav aria-label="Testing Evaluation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-testing-rules">
<span class="md-ellipsis">
      Unit Testing Rules
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-rollouts">
<span class="md-ellipsis">
      Testing Rollouts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-determinism">
<span class="md-ellipsis">
      Testing Determinism
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-specificity-order">
<span class="md-ellipsis">
      Testing Specificity Order
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#best-practices">
<span class="md-ellipsis">
      Best Practices
    </span>
</a>
<nav aria-label="Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#choose-the-right-evaluation-method">
<span class="md-ellipsis">
      Choose the Right Evaluation Method
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#keep-rule-count-low">
<span class="md-ellipsis">
      Keep Rule Count Low
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-specificity-to-your-advantage">
<span class="md-ellipsis">
      Use Specificity to Your Advantage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cache-contexts-when-possible">
<span class="md-ellipsis">
      Cache Contexts When Possible
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#test-rollout-distributions">
<span class="md-ellipsis">
      Test Rollout Distributions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#document-complex-rules">
<span class="md-ellipsis">
      Document Complex Rules
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#examples">
<span class="md-ellipsis">
      Examples
    </span>
</a>
<nav aria-label="Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example-1-simple-boolean-flag">
<span class="md-ellipsis">
      Example 1: Simple Boolean Flag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-2-multi-rule-configuration">
<span class="md-ellipsis">
      Example 2: Multi-Rule Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-3-gradual-rollout-strategy">
<span class="md-ellipsis">
      Example 3: Gradual Rollout Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-4-custom-context-extension">
<span class="md-ellipsis">
      Example 4: Custom Context Extension
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-5-ab-testing">
<span class="md-ellipsis">
      Example 5: A/B Testing
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary-evaluation-guarantees">
<span class="md-ellipsis">
      Summary: Evaluation Guarantees
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="evaluation-flag-evaluation-mechanics">Evaluation: Flag Evaluation Mechanics<a class="headerlink" href="#evaluation-flag-evaluation-mechanics" title="Permanent link">¶</a></h1>
<p>This document explains how Konditional evaluates feature flags, from context creation through rule matching to value resolution. Understanding the evaluation flow helps you write effective targeting rules and debug unexpected behavior.</p>
<hr/>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>Feature flag evaluation is the process of determining which value to return for a given context. Konditional's evaluation engine:</p>
<ul>
<li><strong>Deterministic</strong>: Same context always produces same value</li>
<li><strong>Type-safe</strong>: Returns exactly the declared type, never null</li>
<li><strong>Lock-free</strong>: Multiple threads can evaluate concurrently without contention</li>
<li><strong>Fast</strong>: O(n) complexity where n = number of rules (typically &lt; 10)</li>
</ul>
<p>The evaluation process follows a precise flow: context validation → registry lookup → flag activity check → rule matching → rollout bucketing → value resolution.</p>
<hr/>
<h2 id="evaluation-methods">Evaluation Methods<a class="headerlink" href="#evaluation-methods" title="Permanent link">¶</a></h2>
<p>Konditional provides four evaluation methods, each with different error handling semantics. Choose based on your application's needs.</p>
<h3 id="evaluatesafe-explicit-error-handling">evaluateSafe() - Explicit Error Handling<a class="headerlink" href="#evaluatesafe-explicit-error-handling" title="Permanent link">¶</a></h3>
<p><strong>Recommended for most use cases.</strong> Returns a typed result that distinguishes between success, flag not found, and evaluation errors:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="p">:</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="o">&lt;</span><span class="kt">Boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateSafe</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">)</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">value</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">        </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">FlagNotFound</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">        </span><span class="n">logWarning</span><span class="p">(</span><span class="s">"Flag not registered: </span><span class="si">${</span><span class="n">result</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// Fallback</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">EvaluationError</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">        </span><span class="n">logError</span><span class="p">(</span><span class="s">"Evaluation failed for </span><span class="si">${</span><span class="n">result</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">error</span><span class="p">)</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">        </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// Fallback</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Benefits:</strong>
- Explicit error handling without exceptions
- Distinguish between "flag not found" and "evaluation error"
- Type-safe pattern matching
- Easy to adapt to custom error types via <code>fold()</code></p>
<p><strong>Use when:</strong>
- You need to handle different error cases differently
- You're building production systems with robust error handling
- You want explicit control over failure behavior</p>
<h3 id="evaluateornull-nullable-fallback">evaluateOrNull() - Nullable Fallback<a class="headerlink" href="#evaluateornull-nullable-fallback" title="Permanent link">¶</a></h3>
<p>Returns the value on success, null on any failure:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">darkMode</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrNull</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">)</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">darkMode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="n">darkMode</span><span class="p">)</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="c1">// Flag not found or evaluation failed</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="p">}</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1">// Or use safe call operator</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrNull</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">)</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Use when:</strong>
- You don't need to distinguish between error types
- Null is an acceptable fallback
- You're working in nullable-friendly contexts</p>
<h3 id="evaluateordefault-default-value-fallback">evaluateOrDefault() - Default Value Fallback<a class="headerlink" href="#evaluateordefault-default-value-fallback" title="Permanent link">¶</a></h3>
<p>Returns the value on success, a provided default on any failure:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">darkMode</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="p">)</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="n">applyDarkMode</span><span class="p">(</span><span class="n">darkMode</span><span class="p">)</span><span class="w">  </span><span class="c1">// Always non-null</span>
</span></code></pre></div>
<p><strong>Benefits:</strong>
- Simplest API - no error handling needed
- Non-null return guaranteed
- Explicit default value documents expected fallback</p>
<p><strong>Use when:</strong>
- You have a sensible default value
- You don't need error details
- You want the most concise API</p>
<h3 id="evaluateorthrow-exception-based">evaluateOrThrow() - Exception-Based<a class="headerlink" href="#evaluateorthrow-exception-based" title="Permanent link">¶</a></h3>
<p>Returns the value on success, throws exception on failure:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">darkMode</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrThrow</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">)</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="n">applyDarkMode</span><span class="p">(</span><span class="n">darkMode</span><span class="p">)</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">FlagNotFoundException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="n">logError</span><span class="p">(</span><span class="s">"Flag not registered"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">FlagEvaluationException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="n">logError</span><span class="p">(</span><span class="s">"Evaluation failed"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Throws:</strong>
- <code>FlagNotFoundException</code> - Flag not registered
- <code>FlagEvaluationException</code> - Evaluation error (wraps underlying exception)</p>
<p><strong>Use sparingly!</strong> Prefer <code>evaluateSafe()</code> for explicit error handling.</p>
<p><strong>Use when:</strong>
- Flag not existing is a programmer error (should never happen in production)
- You're in an exception-based codebase
- You want fail-fast behavior during development</p>
<hr/>
<h2 id="evaluation-flow">Evaluation Flow<a class="headerlink" href="#evaluation-flow" title="Permanent link">¶</a></h2>
<p>The evaluation process follows a deterministic sequence of steps:</p>
<pre class="mermaid"><code>flowchart TD
    Start[Context Created] --&gt; Lookup[Registry Lookup]
    Lookup --&gt; Found{Flag Found?}
    Found --&gt;|No| NotFound[Return EvaluationResult.FlagNotFound]
    Found --&gt;|Yes| Active{Flag Active?}
    Active --&gt;|No| Default1[Return Default Value]
    Active --&gt;|Yes| Rules[Get Rules&lt;br/&gt;Sorted by Specificity]

    Rules --&gt; NextRule{Next Rule}
    NextRule --&gt;|No more rules| Default2[Return Default Value]
    NextRule --&gt;|Has rule| MatchBase{Base Criteria&lt;br/&gt;Match?}

    MatchBase --&gt;|No| NextRule
    MatchBase --&gt;|Yes| MatchExt{Extension&lt;br/&gt;Matches?}

    MatchExt --&gt;|No| NextRule
    MatchExt --&gt;|Yes| Rollout{In Rollout&lt;br/&gt;Bucket?}

    Rollout --&gt;|No| NextRule
    Rollout --&gt;|Yes| ReturnValue[Return Rule Value]

    style Start fill:#e1f5ff
    style ReturnValue fill:#d4edda
    style Default1 fill:#fff3cd
    style Default2 fill:#fff3cd
    style NotFound fill:#f8d7da</code></pre>
<h3 id="step-by-step-breakdown">Step-by-Step Breakdown<a class="headerlink" href="#step-by-step-breakdown" title="Permanent link">¶</a></h3>
<p><strong>1. Registry Lookup</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">module</span><span class="p">.</span><span class="na">featureFlag</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">FlagNotFound</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">key</span><span class="p">)</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>The flag must be registered in the correct namespace's registry. Cross-namespace lookups will not find the flag.</p>
<p><strong>2. Flag Activity Check</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">.</span><span class="na">isActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">defaultValue</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="p">}</span>
</span></code></pre></div>
<p>Inactive flags always return the default value, regardless of rules. This provides a kill switch for flags.</p>
<p><strong>3. Rule Iteration (by Specificity)</strong></p>
<p>Rules are pre-sorted by specificity (highest first). Evaluation iterates in specificity order:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">conditionalValue</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rulesSortedBySpecificity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ruleMatches</span><span class="p">(</span><span class="n">conditionalValue</span><span class="p">.</span><span class="na">rule</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">conditionalValue</span><span class="p">.</span><span class="na">value</span><span class="w">  </span><span class="c1">// First match wins</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>4. Base Criteria Matching</strong></p>
<p>All base criteria must match (AND logic):</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1">// Platform check (if specified)</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rule</span><span class="p">.</span><span class="na">platforms</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">platform</span><span class="w"> </span><span class="k">!in</span><span class="w"> </span><span class="n">rule</span><span class="p">.</span><span class="na">platforms</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// Skip this rule</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="p">}</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="c1">// Locale check (if specified)</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rule</span><span class="p">.</span><span class="na">locales</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">locale</span><span class="w"> </span><span class="k">!in</span><span class="w"> </span><span class="n">rule</span><span class="p">.</span><span class="na">locales</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// Skip this rule</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="p">}</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="c1">// Version check (if specified)</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">rule</span><span class="p">.</span><span class="na">versionRange</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">appVersion</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// Skip this rule</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>Empty constraint sets match everything (e.g., no platforms specified = all platforms match).</p>
<p><strong>5. Extension Matching</strong></p>
<p>If the rule has custom extension logic, it must also match:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">rule</span><span class="p">.</span><span class="na">extension</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="n">context</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// Skip this rule</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>6. Rollout Bucketing</strong></p>
<p>Finally, the context must fall into the rollout bucket:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isInRolloutBucket</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">stableId</span><span class="p">,</span><span class="w"> </span><span class="n">rollout</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">// Skip this rule</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>7. Value Resolution</strong></p>
<p>If all checks pass, return the rule's value. Otherwise, continue to next rule or return default.</p>
<hr/>
<h2 id="rule-matching-logic">Rule Matching Logic<a class="headerlink" href="#rule-matching-logic" title="Permanent link">¶</a></h2>
<p>Rules use <strong>AND logic</strong> - all specified criteria must match for the rule to match.</p>
<h3 id="base-matching">Base Matching<a class="headerlink" href="#base-matching" title="Permanent link">¶</a></h3>
<p>Standard targeting criteria from <code>BaseEvaluable</code>:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">ANDROID</span><span class="p">)</span><span class="w">  </span><span class="c1">// Must be iOS OR Android</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_CA</span><span class="p">)</span><span class="w">  </span><span class="c1">// AND English (US or Canada)</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">versions</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="n">min</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">  </span><span class="c1">// AND version &gt;= 2.0.0</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Constraint behavior:</strong>
- <strong>Empty set</strong>: Matches all (e.g., no platforms = all platforms)
- <strong>Non-empty set</strong>: Context value must be in set (OR within the set)
- <strong>Multiple constraints</strong>: All constraints must match (AND across constraints)</p>
<h3 id="extension-matching">Extension Matching<a class="headerlink" href="#extension-matching" title="Permanent link">¶</a></h3>
<p>Custom targeting logic via <code>Evaluable</code>:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">WEB</span><span class="p">)</span><span class="w">  </span><span class="c1">// Base: must be web</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="n">extension</span><span class="w"> </span><span class="p">{</span><span class="w">              </span><span class="c1">// AND extension must match</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">        </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Evaluable</span><span class="o">&lt;</span><span class="n">EnterpriseContext</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">EnterpriseContext</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">                </span><span class="n">context</span><span class="p">.</span><span class="na">subscriptionTier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SubscriptionTier</span><span class="p">.</span><span class="na">ENTERPRISE</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">                </span><span class="n">context</span><span class="p">.</span><span class="na">organizationId</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">"partner-"</span><span class="p">)</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">specificity</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="c1">// Two constraints</span>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="n">premiumValue</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Both must match:</strong> Base criteria AND extension logic.</p>
<h3 id="rollout-matching">Rollout Matching<a class="headerlink" href="#rollout-matching" title="Permanent link">¶</a></h3>
<p>After all criteria match, rollout determines final eligibility:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span><span class="w">  </span><span class="c1">// Must match</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">)</span><span class="w"> </span><span class="c1">// Must match</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">25.0</span><span class="p">)</span><span class="w">  </span><span class="c1">// AND must be in 25% bucket</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></code></pre></div>
<p>Rollout is evaluated last (after all other criteria) to avoid unnecessary bucketing computation.</p>
<hr/>
<h2 id="specificity-ordering">Specificity Ordering<a class="headerlink" href="#specificity-ordering" title="Permanent link">¶</a></h2>
<p>Rules are automatically sorted by <strong>specificity</strong> (most specific first). When multiple rules match, the highest-specificity rule wins.</p>
<h3 id="specificity-calculation">Specificity Calculation<a class="headerlink" href="#specificity-calculation" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">specificity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseSpecificity</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">extensionSpecificity</span>
</span></code></pre></div>
<p><strong>Base specificity</strong> (0-3):
- Platform constraint: +1
- Locale constraint: +1
- Version constraint: +1</p>
<p><strong>Extension specificity</strong>: Value returned by <code>extension.specificity()</code></p>
<h3 id="specificity-examples">Specificity Examples<a class="headerlink" href="#specificity-examples" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// Specificity = 0 (no constraints)</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">MAX</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="n">defaultValue</span><span class="p">)</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="c1">// Specificity = 1 (platform only)</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="n">iosValue</span><span class="p">)</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a>
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="c1">// Specificity = 2 (platform + locale)</span>
</span><span id="__span-14-12"><a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-13"><a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-14-14"><a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">    </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">)</span>
</span><span id="__span-14-15"><a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="n">iosEnglishValue</span><span class="p">)</span>
</span><span id="__span-14-16"><a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a>
</span><span id="__span-14-17"><a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="c1">// Specificity = 3 (platform + locale + version)</span>
</span><span id="__span-14-18"><a href="#__codelineno-14-18" id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-19"><a href="#__codelineno-14-19" id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-14-20"><a href="#__codelineno-14-20" id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">    </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">)</span>
</span><span id="__span-14-21"><a href="#__codelineno-14-21" id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="w">    </span><span class="n">versions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-14-22"><a href="#__codelineno-14-22" id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="n">iosEnglishV2Value</span><span class="p">)</span>
</span><span id="__span-14-23"><a href="#__codelineno-14-23" id="__codelineno-14-23" name="__codelineno-14-23"></a>
</span><span id="__span-14-24"><a href="#__codelineno-14-24" id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="c1">// Specificity = 4 (platform + locale + version + extension)</span>
</span><span id="__span-14-25"><a href="#__codelineno-14-25" id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-26"><a href="#__codelineno-14-26" id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-14-27"><a href="#__codelineno-14-27" id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="w">    </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">)</span>
</span><span id="__span-14-28"><a href="#__codelineno-14-28" id="__codelineno-14-28" name="__codelineno-14-28"></a><span class="w">    </span><span class="n">versions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-14-29"><a href="#__codelineno-14-29" id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="w">    </span><span class="n">extension</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-30"><a href="#__codelineno-14-30" id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="w">        </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Evaluable</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-31"><a href="#__codelineno-14-31" id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-14-32"><a href="#__codelineno-14-32" id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">specificity</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1">// +1 to total</span>
</span><span id="__span-14-33"><a href="#__codelineno-14-33" id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-34"><a href="#__codelineno-14-34" id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-35"><a href="#__codelineno-14-35" id="__codelineno-14-35" name="__codelineno-14-35"></a><span class="p">}.</span><span class="na">returns</span><span class="p">(</span><span class="n">verySpecificValue</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="evaluation-order-visualization">Evaluation Order Visualization<a class="headerlink" href="#evaluation-order-visualization" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>flowchart TD
    Context[Context: iOS, EN_US, v2.1.0] --&gt; Eval[Evaluation]

    Eval --&gt; Rule1["Rule 1: Specificity = 3&lt;br/&gt;platforms(IOS)&lt;br/&gt;locales(EN_US)&lt;br/&gt;versions &gt;= 2.0.0&lt;br/&gt;→ 'specific'"]

    Rule1 --&gt;|Matches| Return1[Return 'specific']

    Rule1 --&gt;|Doesn't Match| Rule2["Rule 2: Specificity = 2&lt;br/&gt;platforms(IOS)&lt;br/&gt;locales(EN_US)&lt;br/&gt;→ 'medium'"]

    Rule2 --&gt;|Matches| Return2[Return 'medium']

    Rule2 --&gt;|Doesn't Match| Rule3["Rule 3: Specificity = 1&lt;br/&gt;platforms(IOS)&lt;br/&gt;→ 'broad'"]

    Rule3 --&gt;|Matches| Return3[Return 'broad']

    Rule3 --&gt;|Doesn't Match| Default[Return Default]

    style Rule1 fill:#d4edda
    style Return1 fill:#d4edda</code></pre>
<p><strong>Key insight:</strong> More specific rules are tried first, ensuring precise targeting overrides general targeting.</p>
<hr/>
<h2 id="rollout-bucketing-algorithm">Rollout Bucketing Algorithm<a class="headerlink" href="#rollout-bucketing-algorithm" title="Permanent link">¶</a></h2>
<p>Rollout bucketing determines which percentage of users see a feature. Konditional uses SHA-256-based hashing for deterministic, stable bucketing.</p>
<h3 id="algorithm">Algorithm<a class="headerlink" href="#algorithm" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">bucket</span><span class="p">(</span><span class="n">flagKey</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">stableId</span><span class="p">:</span><span class="w"> </span><span class="n">StableId</span><span class="p">,</span><span class="w"> </span><span class="n">salt</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="c1">// 1. Create hash input</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"</span><span class="si">$</span><span class="n">salt</span><span class="s">:</span><span class="si">$</span><span class="n">flagKey</span><span class="s">:</span><span class="si">${</span><span class="n">stableId</span><span class="p">.</span><span class="na">id</span><span class="si">}</span><span class="s">"</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="c1">// 2. SHA-256 hash</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">hash</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SHA256</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">toBytes</span><span class="p">())</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="c1">// 3. Take first 4 bytes as 32-bit integer</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">intValue</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="p">(</span><span class="n">hash</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">        </span><span class="p">(</span><span class="n">hash</span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">        </span><span class="p">(</span><span class="n">hash</span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="m">8</span><span class="w">  </span><span class="o">|</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">        </span><span class="p">(</span><span class="n">hash</span><span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span><span class="p">)</span>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="c1">// 4. Modulo 10,000 for 0.01% granularity</span>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">intValue</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">10</span><span class="n">_000</span><span class="w">  </span><span class="c1">// 0-9999</span>
</span><span id="__span-15-18"><a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="p">}</span>
</span><span id="__span-15-19"><a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a>
</span><span id="__span-15-20"><a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">isInRollout</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">rollout</span><span class="p">:</span><span class="w"> </span><span class="n">Rollout</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-21"><a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rollout</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">).</span><span class="na">roundToInt</span><span class="p">()</span><span class="w">  </span><span class="c1">// 25.0 → 2500</span>
</span><span id="__span-15-22"><a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bucket</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">threshold</span>
</span><span id="__span-15-23"><a href="#__codelineno-15-23" id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="bucketing-properties">Bucketing Properties<a class="headerlink" href="#bucketing-properties" title="Permanent link">¶</a></h3>
<p><strong>Deterministic</strong></p>
<p>Same inputs always produce same bucket:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">user1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"abc123"</span><span class="p">)</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user1</span><span class="p">,</span><span class="w"> </span><span class="s">"v1"</span><span class="p">)</span><span class="w">  </span><span class="c1">// Always returns same value (e.g., 4234)</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user1</span><span class="p">,</span><span class="w"> </span><span class="s">"v1"</span><span class="p">)</span><span class="w">  </span><span class="c1">// 4234 again</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user1</span><span class="p">,</span><span class="w"> </span><span class="s">"v1"</span><span class="p">)</span><span class="w">  </span><span class="c1">// 4234 again</span>
</span></code></pre></div>
<p><strong>Independent per Flag</strong></p>
<p>Each flag has its own bucketing space:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"abc123"</span><span class="p">)</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">"v1"</span><span class="p">)</span><span class="w">      </span><span class="c1">// 4234 → In 50% rollout ✓</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"new_checkout"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">"v1"</span><span class="p">)</span><span class="w">   </span><span class="c1">// 7821 → NOT in 50% rollout ✗</span>
</span></code></pre></div>
<p>Same user can be in different buckets for different flags.</p>
<p><strong>Salt-Dependent</strong></p>
<p>Changing salt redistributes users:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"abc123"</span><span class="p">)</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">"v1"</span><span class="p">)</span><span class="w">  </span><span class="c1">// 4234 → In 50% rollout ✓</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">"v2"</span><span class="p">)</span><span class="w">  </span><span class="c1">// 1256 → Still in 50% rollout ✓</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="n">bucket</span><span class="p">(</span><span class="s">"dark_mode"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">"v2"</span><span class="p">)</span><span class="w">  </span><span class="c1">// 1256 (deterministic with new salt)</span>
</span></code></pre></div>
<p>Use salt changes to:
- Reset A/B tests
- Fix biased distributions
- Run new experiments on the same flag</p>
<p><strong>Platform-Stable</strong></p>
<p>SHA-256 produces identical results across platforms:
- JVM (Java 17+)
- Android
- Kotlin/Native (iOS, Desktop)
- Kotlin/JS (Web)</p>
<p>Same user gets same experience everywhere.</p>
<h3 id="granularity">Granularity<a class="headerlink" href="#granularity" title="Permanent link">¶</a></h3>
<p>Bucketing uses 0-9999 range (10,000 buckets), providing <strong>0.01% granularity</strong>:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">0.01</span><span class="p">)</span><span class="w">   </span><span class="c1">// 1 in 10,000 users</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span><span class="w">    </span><span class="c1">// 50 in 10,000 users</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">1.0</span><span class="p">)</span><span class="w">    </span><span class="c1">// 100 in 10,000 users (1%)</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">25.0</span><span class="p">)</span><span class="w">   </span><span class="c1">// 2,500 in 10,000 users (25%)</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">50.0</span><span class="p">)</span><span class="w">   </span><span class="c1">// 5,000 in 10,000 users (50%)</span>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">100.0</span><span class="p">)</span><span class="w">  </span><span class="c1">// All users (no bucketing check)</span>
</span></code></pre></div>
<h3 id="edge-cases">Edge Cases<a class="headerlink" href="#edge-cases" title="Permanent link">¶</a></h3>
<p><strong>0% Rollout</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">0.0</span><span class="p">)</span><span class="w">  </span><span class="c1">// No users match (short-circuits bucketing)</span>
</span></code></pre></div>
<p>Evaluation skips bucketing computation and returns false immediately.</p>
<p><strong>100% Rollout</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">Rollout</span><span class="p">.</span><span class="na">MAX</span><span class="w">  </span><span class="c1">// All users match (short-circuits bucketing)</span>
</span></code></pre></div>
<p>Evaluation skips bucketing computation and returns true immediately.</p>
<hr/>
<h2 id="type-safety-guarantees">Type Safety Guarantees<a class="headerlink" href="#type-safety-guarantees" title="Permanent link">¶</a></h2>
<p>Konditional's type system ensures correct types at every stage of evaluation.</p>
<h3 id="compile-time-type-safety">Compile-Time Type Safety<a class="headerlink" href="#compile-time-type-safety" title="Permanent link">¶</a></h3>
<p><strong>Value type enforcement:</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">AppFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">DARK_MODE</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="p">}</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="c1">// Compiler infers return type</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="kd">val</span><span class="w"> </span><span class="nv">darkMode</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="c1">//            ↑ Type guaranteed by AppFeatures.DARK_MODE's type parameter</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="c1">// Compile error: type mismatch</span>
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="kd">val</span><span class="w"> </span><span class="nv">darkMode</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-22-11"><a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="c1">//            ✗ Type error: Required Boolean, found String</span>
</span></code></pre></div>
<p><strong>Context type enforcement:</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">EnterpriseContext</span><span class="p">(</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">locale</span><span class="p">:</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">,</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">platform</span><span class="p">:</span><span class="w"> </span><span class="n">Platform</span><span class="p">,</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">appVersion</span><span class="p">:</span><span class="w"> </span><span class="n">Version</span><span class="p">,</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">stableId</span><span class="p">:</span><span class="w"> </span><span class="n">StableId</span><span class="p">,</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">subscriptionTier</span><span class="p">:</span><span class="w"> </span><span class="n">SubscriptionTier</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Context</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="kd">object</span><span class="w"> </span><span class="nc">PremiumFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Payments</span><span class="o">&gt;</span><span class="p">(</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="n">Namespace</span><span class="p">.</span><span class="na">Payments</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">    </span><span class="c1">// This feature requires EnterpriseContext</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">DATA_EXPORT</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="p">}</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="kd">val</span><span class="w"> </span><span class="nv">basicContext</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(...)</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="c1">// Type error: EnterpriseContext required</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="n">basicContext</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">PremiumFeatures</span><span class="p">.</span><span class="na">DATA_EXPORT</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// ✗</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a>
</span><span id="__span-23-20"><a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="kd">val</span><span class="w"> </span><span class="nv">enterpriseContext</span><span class="p">:</span><span class="w"> </span><span class="n">EnterpriseContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EnterpriseContext</span><span class="p">(...)</span>
</span><span id="__span-23-21"><a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="n">enterpriseContext</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">PremiumFeatures</span><span class="p">.</span><span class="na">DATA_EXPORT</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// ✓</span>
</span></code></pre></div>
<h3 id="runtime-type-safety">Runtime Type Safety<a class="headerlink" href="#runtime-type-safety" title="Permanent link">¶</a></h3>
<p><strong>Non-null guarantees:</strong></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1">// evaluateOrDefault() always returns T, never null</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// Never null</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="c1">// evaluateSafe() wraps value in Success, never null</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateSafe</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">value</span><span class="w">  </span><span class="c1">// Never null</span>
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>No type coercion:</strong></p>
<p>Traditional systems allow runtime type errors:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1">// String-based system</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">config</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">"retries"</span><span class="p">,</span><span class="w"> </span><span class="s">"not a number"</span><span class="p">)</span><span class="w">  </span><span class="c1">// ✓ Compiles</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="kd">val</span><span class="w"> </span><span class="nv">retries</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">"retries"</span><span class="p">)</span><span class="w">  </span><span class="c1">// 💣 Runtime error or default</span>
</span></code></pre></div>
<p>Konditional makes this impossible:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">AppConfig</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">RETRIES</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">int</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="p">}</span>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="c1">// ✗ Compile error: Required Int, found String</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="kd">val</span><span class="w"> </span><span class="nv">RETRIES</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">int</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"not a number"</span><span class="p">)</span>
</span></code></pre></div>
<hr/>
<h2 id="performance-characteristics">Performance Characteristics<a class="headerlink" href="#performance-characteristics" title="Permanent link">¶</a></h2>
<h3 id="time-complexity">Time Complexity<a class="headerlink" href="#time-complexity" title="Permanent link">¶</a></h3>
<p><strong>Evaluation</strong>: O(n) where n = number of rules per flag</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1">// Worst case: iterate all rules</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rule</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rulesSortedBySpecificity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// O(n)</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">matches</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// O(1) per rule</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">rule</span><span class="p">.</span><span class="na">value</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>Typical flags have 1-5 rules, so evaluation is effectively O(1) in practice.</p>
<p><strong>Registry lookup</strong>: O(1) hash table lookup</p>
<p><strong>Rollout bucketing</strong>: O(1) SHA-256 hash + modulo</p>
<p><strong>Total</strong>: O(n) where n is typically &lt; 10</p>
<h3 id="space-complexity">Space Complexity<a class="headerlink" href="#space-complexity" title="Permanent link">¶</a></h3>
<p><strong>Zero allocations during evaluation</strong></p>
<p>All data structures are pre-allocated and immutable:
- Rules sorted once at configuration time
- No intermediate objects created
- No string concatenation (except for bucketing hash input)</p>
<p><strong>Memory footprint per flag</strong>: ~200-500 bytes</p>
<ul>
<li>FlagDefinition overhead: ~100 bytes</li>
<li>Per-rule overhead: ~50-100 bytes</li>
<li>Strings (key, notes): variable</li>
</ul>
<h3 id="concurrency-performance">Concurrency Performance<a class="headerlink" href="#concurrency-performance" title="Permanent link">¶</a></h3>
<p><strong>Lock-free reads</strong>: No synchronization required</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1">// Multiple threads evaluating concurrently</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">thread1</span><span class="p">:</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// No lock</span>
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">thread2</span><span class="p">:</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// No lock</span>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="n">thread3</span><span class="p">:</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// No lock</span>
</span></code></pre></div>
<p><strong>Atomic updates</strong>: Registry updates use <code>AtomicReference</code></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1">// Update sees either old or new configuration atomically</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">newKonfig</span><span class="p">)</span><span class="w">  </span><span class="c1">// Atomic swap</span>
</span></code></pre></div>
<p><strong>Scalability</strong>: Evaluation throughput scales linearly with CPU cores (no contention).</p>
<hr/>
<h2 id="thread-safety">Thread Safety<a class="headerlink" href="#thread-safety" title="Permanent link">¶</a></h2>
<p>Konditional is designed for concurrent access without locks.</p>
<h3 id="lock-free-reads">Lock-Free Reads<a class="headerlink" href="#lock-free-reads" title="Permanent link">¶</a></h3>
<p>Flag evaluation requires no synchronization:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1">// Safe concurrent evaluation</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1.</span><span class="p">.</span><span class="m">100</span><span class="p">).</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">threadId</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">    </span><span class="n">thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">        </span><span class="n">repeat</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-5"><a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-30-6"><a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">            </span><span class="n">processValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-30-7"><a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-8"><a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-9"><a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="p">}</span>
</span><span id="__span-30-10"><a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="n">threads</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">join</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>How it works:</strong>
- Immutable data structures (<code>FlagDefinition</code>, <code>Konfig</code>)
- AtomicReference for registry snapshot
- Readers see consistent snapshot (old or new, never partial)</p>
<h3 id="atomic-updates">Atomic Updates<a class="headerlink" href="#atomic-updates" title="Permanent link">¶</a></h3>
<p>Registry updates are atomic:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1">// Thread 1: Updating configuration</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">newKonfig</span><span class="p">)</span><span class="w">  </span><span class="c1">// Atomic swap</span>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="c1">// Thread 2: Reading during update</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="kd">val</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">// Sees old OR new, never mixed</span>
</span></code></pre></div>
<p><strong>Guarantees:</strong>
- Updates are atomic (all-or-nothing)
- Readers never see partial updates
- No torn reads</p>
<h3 id="independent-evaluations">Independent Evaluations<a class="headerlink" href="#independent-evaluations" title="Permanent link">¶</a></h3>
<p>Each evaluation is stateless:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1">// No shared mutable state</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">evaluateOrDefault</span><span class="p">(</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">Feature</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="p">:</span><span class="w"> </span><span class="n">T</span><span class="p">):</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">    </span><span class="c1">// Only reads from immutable data structures</span>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span><span class="c1">// No writes, no locks, no shared state</span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">flag</span><span class="p">.</span><span class="na">evaluate</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">default</span>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Benefits:</strong>
- No race conditions
- No deadlocks
- Predictable performance</p>
<hr/>
<h2 id="testing-evaluation">Testing Evaluation<a class="headerlink" href="#testing-evaluation" title="Permanent link">¶</a></h2>
<h3 id="unit-testing-rules">Unit Testing Rules<a class="headerlink" href="#unit-testing-rules" title="Permanent link">¶</a></h3>
<p>Test that rules evaluate correctly for different contexts:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="nd">@Test</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">`iOS users in EN_US locale get dark mode`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">    </span><span class="c1">// Arrange</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">        </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">        </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span>
</span><span id="__span-33-7"><a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">        </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"2.1.0"</span><span class="p">),</span>
</span><span id="__span-33-8"><a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">        </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"test-user"</span><span class="p">)</span>
</span><span id="__span-33-9"><a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-33-10"><a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a>
</span><span id="__span-33-11"><a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">    </span><span class="c1">// Act</span>
</span><span id="__span-33-12"><a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateSafe</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">)</span>
</span><span id="__span-33-13"><a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a>
</span><span id="__span-33-14"><a href="#__codelineno-33-14" id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">    </span><span class="c1">// Assert</span>
</span><span id="__span-33-15"><a href="#__codelineno-33-15" id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-33-16"><a href="#__codelineno-33-16" id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="p">}</span>
</span><span id="__span-33-17"><a href="#__codelineno-33-17" id="__codelineno-33-17" name="__codelineno-33-17"></a>
</span><span id="__span-33-18"><a href="#__codelineno-33-18" id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="nd">@Test</span>
</span><span id="__span-33-19"><a href="#__codelineno-33-19" id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">`Android users get default value`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-20"><a href="#__codelineno-33-20" id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-33-21"><a href="#__codelineno-33-21" id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="w">        </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-33-22"><a href="#__codelineno-33-22" id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="w">        </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">ANDROID</span><span class="p">,</span>
</span><span id="__span-33-23"><a href="#__codelineno-33-23" id="__codelineno-33-23" name="__codelineno-33-23"></a><span class="w">        </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"2.1.0"</span><span class="p">),</span>
</span><span id="__span-33-24"><a href="#__codelineno-33-24" id="__codelineno-33-24" name="__codelineno-33-24"></a><span class="w">        </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"test-user"</span><span class="p">)</span>
</span><span id="__span-33-25"><a href="#__codelineno-33-25" id="__codelineno-33-25" name="__codelineno-33-25"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-33-26"><a href="#__codelineno-33-26" id="__codelineno-33-26" name="__codelineno-33-26"></a>
</span><span id="__span-33-27"><a href="#__codelineno-33-27" id="__codelineno-33-27" name="__codelineno-33-27"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateSafe</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">)</span>
</span><span id="__span-33-28"><a href="#__codelineno-33-28" id="__codelineno-33-28" name="__codelineno-33-28"></a>
</span><span id="__span-33-29"><a href="#__codelineno-33-29" id="__codelineno-33-29" name="__codelineno-33-29"></a><span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-33-30"><a href="#__codelineno-33-30" id="__codelineno-33-30" name="__codelineno-33-30"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="testing-rollouts">Testing Rollouts<a class="headerlink" href="#testing-rollouts" title="Permanent link">¶</a></h3>
<p>Test rollout distribution over many users:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nd">@Test</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="kd">fun</span><span class="w"> </span><span class="err">`50 </span><span class="nf">percent</span><span class="w"> </span><span class="n">rollout</span><span class="w"> </span><span class="n">distributes</span><span class="w"> </span><span class="n">correctly</span><span class="err">`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="c1">// Test over many users</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sampleSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="n">_000</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">enabledCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">sampleSize</span><span class="p">).</span><span class="na">count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">            </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-34-8"><a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">            </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span>
</span><span id="__span-34-9"><a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">            </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"1.0.0"</span><span class="p">),</span>
</span><span id="__span-34-10"><a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">            </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"user-</span><span class="si">$</span><span class="n">i</span><span class="s">"</span><span class="p">)</span>
</span><span id="__span-34-11"><a href="#__codelineno-34-11" id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-34-12"><a href="#__codelineno-34-12" id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">ROLLOUT_FLAG</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-34-13"><a href="#__codelineno-34-13" id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-14"><a href="#__codelineno-34-14" id="__codelineno-34-14" name="__codelineno-34-14"></a>
</span><span id="__span-34-15"><a href="#__codelineno-34-15" id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="w">    </span><span class="c1">// Assert approximately 50% (allow 2% variance)</span>
</span><span id="__span-34-16"><a href="#__codelineno-34-16" id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">enabledCount</span><span class="p">.</span><span class="na">toDouble</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleSize</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-34-17"><a href="#__codelineno-34-17" id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">percentage</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">48.0</span><span class="p">..</span><span class="m">52.0</span><span class="p">,</span><span class="w"> </span><span class="s">"Got </span><span class="si">$</span><span class="n">percentage</span><span class="s">%, expected ~50%"</span><span class="p">)</span>
</span><span id="__span-34-18"><a href="#__codelineno-34-18" id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="testing-determinism">Testing Determinism<a class="headerlink" href="#testing-determinism" title="Permanent link">¶</a></h3>
<p>Verify same context always returns same value:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nd">@Test</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">`evaluation is deterministic`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">        </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">        </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span>
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">        </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"2.1.0"</span><span class="p">),</span>
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">        </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"user-123"</span><span class="p">)</span>
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-35-9"><a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a>
</span><span id="__span-35-10"><a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">    </span><span class="c1">// Evaluate many times</span>
</span><span id="__span-35-11"><a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1.</span><span class="p">.</span><span class="m">100</span><span class="p">).</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-12"><a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-35-13"><a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-14"><a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a>
</span><span id="__span-35-15"><a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="w">    </span><span class="c1">// All results must be identical</span>
</span><span id="__span-35-16"><a href="#__codelineno-35-16" id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="na">distinct</span><span class="p">().</span><span class="na">size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s">"Non-deterministic evaluation"</span><span class="p">)</span>
</span><span id="__span-35-17"><a href="#__codelineno-35-17" id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="testing-specificity-order">Testing Specificity Order<a class="headerlink" href="#testing-specificity-order" title="Permanent link">¶</a></h3>
<p>Verify higher specificity rules take precedence:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nd">@Test</span>
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">`more specific rules override general rules`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-3"><a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">TestFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-4"><a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"default"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-5"><a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">            </span><span class="c1">// Specificity = 1 (general)</span>
</span><span id="__span-36-6"><a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">            </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-7"><a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">                </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-36-8"><a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"ios-general"</span>
</span><span id="__span-36-9"><a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a>
</span><span id="__span-36-10"><a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">            </span><span class="c1">// Specificity = 2 (specific)</span>
</span><span id="__span-36-11"><a href="#__codelineno-36-11" id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">            </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-12"><a href="#__codelineno-36-12" id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">                </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-36-13"><a href="#__codelineno-36-13" id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">                </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">)</span>
</span><span id="__span-36-14"><a href="#__codelineno-36-14" id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"ios-english-specific"</span>
</span><span id="__span-36-15"><a href="#__codelineno-36-15" id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-36-16"><a href="#__codelineno-36-16" id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-17"><a href="#__codelineno-36-17" id="__codelineno-36-17" name="__codelineno-36-17"></a>
</span><span id="__span-36-18"><a href="#__codelineno-36-18" id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">    </span><span class="c1">// Context matches both rules</span>
</span><span id="__span-36-19"><a href="#__codelineno-36-19" id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-36-20"><a href="#__codelineno-36-20" id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">        </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-36-21"><a href="#__codelineno-36-21" id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="w">        </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span>
</span><span id="__span-36-22"><a href="#__codelineno-36-22" id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="w">        </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"1.0.0"</span><span class="p">),</span>
</span><span id="__span-36-23"><a href="#__codelineno-36-23" id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="w">        </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"user-123"</span><span class="p">)</span>
</span><span id="__span-36-24"><a href="#__codelineno-36-24" id="__codelineno-36-24" name="__codelineno-36-24"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-36-25"><a href="#__codelineno-36-25" id="__codelineno-36-25" name="__codelineno-36-25"></a>
</span><span id="__span-36-26"><a href="#__codelineno-36-26" id="__codelineno-36-26" name="__codelineno-36-26"></a><span class="w">    </span><span class="c1">// Higher specificity wins</span>
</span><span id="__span-36-27"><a href="#__codelineno-36-27" id="__codelineno-36-27" name="__codelineno-36-27"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">TestFeatures</span><span class="p">.</span><span class="na">VALUE</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">)</span>
</span><span id="__span-36-28"><a href="#__codelineno-36-28" id="__codelineno-36-28" name="__codelineno-36-28"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="s">"ios-english-specific"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-36-29"><a href="#__codelineno-36-29" id="__codelineno-36-29" name="__codelineno-36-29"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">¶</a></h2>
<h3 id="choose-the-right-evaluation-method">Choose the Right Evaluation Method<a class="headerlink" href="#choose-the-right-evaluation-method" title="Permanent link">¶</a></h3>
<p><strong>For production code:</strong>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-37-1"><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1">// Use evaluateSafe for explicit error handling</span>
</span><span id="__span-37-2"><a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateSafe</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-3"><a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">process</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">value</span><span class="p">)</span>
</span><span id="__span-37-4"><a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">FlagNotFound</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logWarning</span><span class="p">(</span><span class="s">"Flag not found"</span><span class="p">)</span>
</span><span id="__span-37-5"><a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">EvaluationResult</span><span class="p">.</span><span class="na">EvaluationError</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logError</span><span class="p">(</span><span class="s">"Evaluation failed"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">error</span><span class="p">)</span>
</span><span id="__span-37-6"><a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>For simple cases:</strong>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1">// Use evaluateOrDefault for concise code with sensible defaults</span>
</span><span id="__span-38-2"><a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Avoid evaluateOrThrow</strong> unless flag not existing is a programmer error.</p>
<h3 id="keep-rule-count-low">Keep Rule Count Low<a class="headerlink" href="#keep-rule-count-low" title="Permanent link">¶</a></h3>
<p>Each flag iterates rules until match. Keep rules minimal:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-39-1"><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1">// ✓ Good: 2-3 rules</span>
</span><span id="__span-39-2"><a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">FEATURE</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-3"><a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">    </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-39-4"><a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">    </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-39-5"><a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="p">}</span>
</span><span id="__span-39-6"><a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a>
</span><span id="__span-39-7"><a href="#__codelineno-39-7" id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="c1">// ✗ Avoid: Too many rules</span>
</span><span id="__span-39-8"><a href="#__codelineno-39-8" id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="kd">val</span><span class="w"> </span><span class="nv">FEATURE</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-9"><a href="#__codelineno-39-9" id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">    </span><span class="c1">// 20+ rules = slower evaluation</span>
</span><span id="__span-39-10"><a href="#__codelineno-39-10" id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>If you have many rules, consider redesigning with custom context fields and extension logic.</p>
<h3 id="use-specificity-to-your-advantage">Use Specificity to Your Advantage<a class="headerlink" href="#use-specificity-to-your-advantage" title="Permanent link">¶</a></h3>
<p>Write rules from most to least specific. While Konditional sorts automatically, this mental model makes configurations clearer:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-40-1"><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"default"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-2"><a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="w">    </span><span class="c1">// Most specific (evaluated first)</span>
</span><span id="__span-40-3"><a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">    </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-4"><a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">        </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-40-5"><a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">        </span><span class="n">locales</span><span class="p">(</span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">)</span>
</span><span id="__span-40-6"><a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">        </span><span class="n">versions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-40-7"><a href="#__codelineno-40-7" id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"ios-en-v2"</span>
</span><span id="__span-40-8"><a href="#__codelineno-40-8" id="__codelineno-40-8" name="__codelineno-40-8"></a>
</span><span id="__span-40-9"><a href="#__codelineno-40-9" id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="w">    </span><span class="c1">// Less specific (evaluated second)</span>
</span><span id="__span-40-10"><a href="#__codelineno-40-10" id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="w">    </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-11"><a href="#__codelineno-40-11" id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">        </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-40-12"><a href="#__codelineno-40-12" id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"ios-all"</span>
</span><span id="__span-40-13"><a href="#__codelineno-40-13" id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="cache-contexts-when-possible">Cache Contexts When Possible<a class="headerlink" href="#cache-contexts-when-possible" title="Permanent link">¶</a></h3>
<p>Creating contexts is cheap, but reusing them is cheaper:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-41-1"><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1">// ✓ Good: Create once, reuse for multiple evaluations</span>
</span><span id="__span-41-2"><a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createUserContext</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span id="__span-41-3"><a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="kd">val</span><span class="w"> </span><span class="nv">darkMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-41-4"><a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="kd">val</span><span class="w"> </span><span class="nv">apiEndpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">API_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="s">"default"</span><span class="p">)</span>
</span><span id="__span-41-5"><a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="kd">val</span><span class="w"> </span><span class="nv">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">MAX_RETRIES</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</span><span id="__span-41-6"><a href="#__codelineno-41-6" id="__codelineno-41-6" name="__codelineno-41-6"></a>
</span><span id="__span-41-7"><a href="#__codelineno-41-7" id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="c1">// ✗ Avoid: Recreating context for each evaluation</span>
</span><span id="__span-41-8"><a href="#__codelineno-41-8" id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="n">createUserContext</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-41-9"><a href="#__codelineno-41-9" id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="n">createUserContext</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">API_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="s">"default"</span><span class="p">)</span>
</span><span id="__span-41-10"><a href="#__codelineno-41-10" id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="n">createUserContext</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">MAX_RETRIES</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="test-rollout-distributions">Test Rollout Distributions<a class="headerlink" href="#test-rollout-distributions" title="Permanent link">¶</a></h3>
<p>When using rollouts, verify distribution over sample population:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-42-1"><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="nd">@Test</span>
</span><span id="__span-42-2"><a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">`rollout distribution is balanced`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-3"><a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sampleSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5000</span>
</span><span id="__span-42-4"><a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">enabledCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">sampleSize</span><span class="p">).</span><span class="na">count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-42-5"><a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-42-6"><a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">            </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-42-7"><a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">            </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span>
</span><span id="__span-42-8"><a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">            </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"1.0.0"</span><span class="p">),</span>
</span><span id="__span-42-9"><a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">            </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"user-</span><span class="si">$</span><span class="n">i</span><span class="s">"</span><span class="p">)</span>
</span><span id="__span-42-10"><a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-42-11"><a href="#__codelineno-42-11" id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">ROLLOUT_FLAG</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-42-12"><a href="#__codelineno-42-12" id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-42-13"><a href="#__codelineno-42-13" id="__codelineno-42-13" name="__codelineno-42-13"></a>
</span><span id="__span-42-14"><a href="#__codelineno-42-14" id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">enabledCount</span><span class="p">.</span><span class="na">toDouble</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleSize</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-42-15"><a href="#__codelineno-42-15" id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="w">    </span><span class="c1">// Expected 25%, allow 2% variance</span>
</span><span id="__span-42-16"><a href="#__codelineno-42-16" id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">percentage</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">23.0</span><span class="p">..</span><span class="m">27.0</span><span class="p">)</span>
</span><span id="__span-42-17"><a href="#__codelineno-42-17" id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="document-complex-rules">Document Complex Rules<a class="headerlink" href="#document-complex-rules" title="Permanent link">¶</a></h3>
<p>Use <code>note()</code> to explain non-obvious targeting:</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-43-1"><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="w">    </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-43-3"><a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">    </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">15.0</span><span class="p">)</span>
</span><span id="__span-43-4"><a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">    </span><span class="n">note</span><span class="p">(</span><span class="s">"Targeting high-value iOS users - approved by PM on 2024-01-15"</span><span class="p">)</span>
</span><span id="__span-43-5"><a href="#__codelineno-43-5" id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span></code></pre></div>
<p>Notes appear in serialized JSON and help with debugging.</p>
<hr/>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">¶</a></h2>
<h3 id="example-1-simple-boolean-flag">Example 1: Simple Boolean Flag<a class="headerlink" href="#example-1-simple-boolean-flag" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-44-1"><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">AppFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">DARK_MODE</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-3"><a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-4"><a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">ANDROID</span><span class="p">)</span>
</span><span id="__span-44-5"><a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">            </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">50.0</span><span class="p">)</span>
</span><span id="__span-44-6"><a href="#__codelineno-44-6" id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-44-7"><a href="#__codelineno-44-7" id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-44-8"><a href="#__codelineno-44-8" id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="p">}</span>
</span><span id="__span-44-9"><a href="#__codelineno-44-9" id="__codelineno-44-9" name="__codelineno-44-9"></a>
</span><span id="__span-44-10"><a href="#__codelineno-44-10" id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="c1">// Evaluation</span>
</span><span id="__span-44-11"><a href="#__codelineno-44-11" id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">(</span>
</span><span id="__span-44-12"><a href="#__codelineno-44-12" id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">    </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-44-13"><a href="#__codelineno-44-13" id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="w">    </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">,</span>
</span><span id="__span-44-14"><a href="#__codelineno-44-14" id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="w">    </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"2.1.0"</span><span class="p">),</span>
</span><span id="__span-44-15"><a href="#__codelineno-44-15" id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="w">    </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"user-abc123"</span><span class="p">)</span>
</span><span id="__span-44-16"><a href="#__codelineno-44-16" id="__codelineno-44-16" name="__codelineno-44-16"></a><span class="p">)</span>
</span><span id="__span-44-17"><a href="#__codelineno-44-17" id="__codelineno-44-17" name="__codelineno-44-17"></a>
</span><span id="__span-44-18"><a href="#__codelineno-44-18" id="__codelineno-44-18" name="__codelineno-44-18"></a><span class="kd">val</span><span class="w"> </span><span class="nv">isDarkMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">AppFeatures</span><span class="p">.</span><span class="na">DARK_MODE</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-44-19"><a href="#__codelineno-44-19" id="__codelineno-44-19" name="__codelineno-44-19"></a>
</span><span id="__span-44-20"><a href="#__codelineno-44-20" id="__codelineno-44-20" name="__codelineno-44-20"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isDarkMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-21"><a href="#__codelineno-44-21" id="__codelineno-44-21" name="__codelineno-44-21"></a><span class="w">    </span><span class="n">applyDarkTheme</span><span class="p">()</span>
</span><span id="__span-44-22"><a href="#__codelineno-44-22" id="__codelineno-44-22" name="__codelineno-44-22"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-23"><a href="#__codelineno-44-23" id="__codelineno-44-23" name="__codelineno-44-23"></a><span class="w">    </span><span class="n">applyLightTheme</span><span class="p">()</span>
</span><span id="__span-44-24"><a href="#__codelineno-44-24" id="__codelineno-44-24" name="__codelineno-44-24"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="example-2-multi-rule-configuration">Example 2: Multi-Rule Configuration<a class="headerlink" href="#example-2-multi-rule-configuration" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">ApiConfig</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-2"><a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">ENDPOINT</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://api.prod.example.com"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-3"><a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">        </span><span class="c1">// Specificity = 2: iOS + version</span>
</span><span id="__span-45-4"><a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-5"><a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-45-6"><a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="w">            </span><span class="n">versions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-45-7"><a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"https://api-v3-ios.example.com"</span>
</span><span id="__span-45-8"><a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a>
</span><span id="__span-45-9"><a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="w">        </span><span class="c1">// Specificity = 1: iOS only</span>
</span><span id="__span-45-10"><a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-11"><a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">IOS</span><span class="p">)</span>
</span><span id="__span-45-12"><a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"https://api-ios.example.com"</span>
</span><span id="__span-45-13"><a href="#__codelineno-45-13" id="__codelineno-45-13" name="__codelineno-45-13"></a>
</span><span id="__span-45-14"><a href="#__codelineno-45-14" id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="w">        </span><span class="c1">// Specificity = 1: Android only</span>
</span><span id="__span-45-15"><a href="#__codelineno-45-15" id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-16"><a href="#__codelineno-45-16" id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">ANDROID</span><span class="p">)</span>
</span><span id="__span-45-17"><a href="#__codelineno-45-17" id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"https://api-android.example.com"</span>
</span><span id="__span-45-18"><a href="#__codelineno-45-18" id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-45-19"><a href="#__codelineno-45-19" id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="p">}</span>
</span><span id="__span-45-20"><a href="#__codelineno-45-20" id="__codelineno-45-20" name="__codelineno-45-20"></a>
</span><span id="__span-45-21"><a href="#__codelineno-45-21" id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="c1">// iOS v3.0.0 → "https://api-v3-ios.example.com" (highest specificity)</span>
</span><span id="__span-45-22"><a href="#__codelineno-45-22" id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="c1">// iOS v2.0.0 → "https://api-ios.example.com" (medium specificity)</span>
</span><span id="__span-45-23"><a href="#__codelineno-45-23" id="__codelineno-45-23" name="__codelineno-45-23"></a><span class="c1">// Android → "https://api-android.example.com" (medium specificity)</span>
</span><span id="__span-45-24"><a href="#__codelineno-45-24" id="__codelineno-45-24" name="__codelineno-45-24"></a><span class="c1">// Web → "https://api.prod.example.com" (default)</span>
</span></code></pre></div>
<h3 id="example-3-gradual-rollout-strategy">Example 3: Gradual Rollout Strategy<a class="headerlink" href="#example-3-gradual-rollout-strategy" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">NewFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-2"><a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">NEW_CHECKOUT</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-3"><a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">        </span><span class="n">salt</span><span class="p">(</span><span class="s">"v1"</span><span class="p">)</span><span class="w">  </span><span class="c1">// Change to redistribute users</span>
</span><span id="__span-46-4"><a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a>
</span><span id="__span-46-5"><a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-6"><a href="#__codelineno-46-6" id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">ANDROID</span><span class="p">)</span>
</span><span id="__span-46-7"><a href="#__codelineno-46-7" id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="w">            </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">10.0</span><span class="p">)</span><span class="w">  </span><span class="c1">// Start with 10%</span>
</span><span id="__span-46-8"><a href="#__codelineno-46-8" id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="w">            </span><span class="n">note</span><span class="p">(</span><span class="s">"Phase 1: Initial Android rollout"</span><span class="p">)</span>
</span><span id="__span-46-9"><a href="#__codelineno-46-9" id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-46-10"><a href="#__codelineno-46-10" id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-11"><a href="#__codelineno-46-11" id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="p">}</span>
</span><span id="__span-46-12"><a href="#__codelineno-46-12" id="__codelineno-46-12" name="__codelineno-46-12"></a>
</span><span id="__span-46-13"><a href="#__codelineno-46-13" id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="c1">// Phase 1: 10% of Android users</span>
</span><span id="__span-46-14"><a href="#__codelineno-46-14" id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="c1">// Monitor metrics, then increase:</span>
</span><span id="__span-46-15"><a href="#__codelineno-46-15" id="__codelineno-46-15" name="__codelineno-46-15"></a>
</span><span id="__span-46-16"><a href="#__codelineno-46-16" id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="kd">object</span><span class="w"> </span><span class="nc">NewFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-17"><a href="#__codelineno-46-17" id="__codelineno-46-17" name="__codelineno-46-17"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">NEW_CHECKOUT</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-18"><a href="#__codelineno-46-18" id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="w">        </span><span class="n">salt</span><span class="p">(</span><span class="s">"v1"</span><span class="p">)</span>
</span><span id="__span-46-19"><a href="#__codelineno-46-19" id="__codelineno-46-19" name="__codelineno-46-19"></a>
</span><span id="__span-46-20"><a href="#__codelineno-46-20" id="__codelineno-46-20" name="__codelineno-46-20"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-21"><a href="#__codelineno-46-21" id="__codelineno-46-21" name="__codelineno-46-21"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">ANDROID</span><span class="p">)</span>
</span><span id="__span-46-22"><a href="#__codelineno-46-22" id="__codelineno-46-22" name="__codelineno-46-22"></a><span class="w">            </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">50.0</span><span class="p">)</span><span class="w">  </span><span class="c1">// Increased to 50%</span>
</span><span id="__span-46-23"><a href="#__codelineno-46-23" id="__codelineno-46-23" name="__codelineno-46-23"></a><span class="w">            </span><span class="n">note</span><span class="p">(</span><span class="s">"Phase 2: Expanded Android rollout"</span><span class="p">)</span>
</span><span id="__span-46-24"><a href="#__codelineno-46-24" id="__codelineno-46-24" name="__codelineno-46-24"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-46-25"><a href="#__codelineno-46-25" id="__codelineno-46-25" name="__codelineno-46-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-26"><a href="#__codelineno-46-26" id="__codelineno-46-26" name="__codelineno-46-26"></a><span class="p">}</span>
</span><span id="__span-46-27"><a href="#__codelineno-46-27" id="__codelineno-46-27" name="__codelineno-46-27"></a>
</span><span id="__span-46-28"><a href="#__codelineno-46-28" id="__codelineno-46-28" name="__codelineno-46-28"></a><span class="c1">// Phase 2: 50% of Android users</span>
</span><span id="__span-46-29"><a href="#__codelineno-46-29" id="__codelineno-46-29" name="__codelineno-46-29"></a><span class="c1">// Users in initial 10% stay enabled (deterministic bucketing)</span>
</span></code></pre></div>
<h3 id="example-4-custom-context-extension">Example 4: Custom Context Extension<a class="headerlink" href="#example-4-custom-context-extension" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">EnterpriseContext</span><span class="p">(</span>
</span><span id="__span-47-2"><a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">locale</span><span class="p">:</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">,</span>
</span><span id="__span-47-3"><a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">platform</span><span class="p">:</span><span class="w"> </span><span class="n">Platform</span><span class="p">,</span>
</span><span id="__span-47-4"><a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">appVersion</span><span class="p">:</span><span class="w"> </span><span class="n">Version</span><span class="p">,</span>
</span><span id="__span-47-5"><a href="#__codelineno-47-5" id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">stableId</span><span class="p">:</span><span class="w"> </span><span class="n">StableId</span><span class="p">,</span>
</span><span id="__span-47-6"><a href="#__codelineno-47-6" id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">subscriptionTier</span><span class="p">:</span><span class="w"> </span><span class="n">SubscriptionTier</span><span class="p">,</span>
</span><span id="__span-47-7"><a href="#__codelineno-47-7" id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">organizationId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
</span><span id="__span-47-8"><a href="#__codelineno-47-8" id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Context</span>
</span><span id="__span-47-9"><a href="#__codelineno-47-9" id="__codelineno-47-9" name="__codelineno-47-9"></a>
</span><span id="__span-47-10"><a href="#__codelineno-47-10" id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SubscriptionTier</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FREE</span><span class="p">,</span><span class="w"> </span><span class="n">PROFESSIONAL</span><span class="p">,</span><span class="w"> </span><span class="n">ENTERPRISE</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-47-11"><a href="#__codelineno-47-11" id="__codelineno-47-11" name="__codelineno-47-11"></a>
</span><span id="__span-47-12"><a href="#__codelineno-47-12" id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="kd">object</span><span class="w"> </span><span class="nc">PremiumFeatures</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Payments</span><span class="o">&gt;</span><span class="p">(</span>
</span><span id="__span-47-13"><a href="#__codelineno-47-13" id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="w">    </span><span class="n">Namespace</span><span class="p">.</span><span class="na">Payments</span>
</span><span id="__span-47-14"><a href="#__codelineno-47-14" id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-15"><a href="#__codelineno-47-15" id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">DATA_EXPORT</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">boolean</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-16"><a href="#__codelineno-47-16" id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-17"><a href="#__codelineno-47-17" id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="w">            </span><span class="n">platforms</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">WEB</span><span class="p">)</span>
</span><span id="__span-47-18"><a href="#__codelineno-47-18" id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="w">            </span><span class="n">extension</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-19"><a href="#__codelineno-47-19" id="__codelineno-47-19" name="__codelineno-47-19"></a><span class="w">                </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Evaluable</span><span class="o">&lt;</span><span class="n">EnterpriseContext</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-20"><a href="#__codelineno-47-20" id="__codelineno-47-20" name="__codelineno-47-20"></a><span class="w">                    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">EnterpriseContext</span><span class="p">):</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-47-21"><a href="#__codelineno-47-21" id="__codelineno-47-21" name="__codelineno-47-21"></a><span class="w">                        </span><span class="n">context</span><span class="p">.</span><span class="na">subscriptionTier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SubscriptionTier</span><span class="p">.</span><span class="na">ENTERPRISE</span>
</span><span id="__span-47-22"><a href="#__codelineno-47-22" id="__codelineno-47-22" name="__codelineno-47-22"></a>
</span><span id="__span-47-23"><a href="#__codelineno-47-23" id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="w">                    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">specificity</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-47-24"><a href="#__codelineno-47-24" id="__codelineno-47-24" name="__codelineno-47-24"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-47-25"><a href="#__codelineno-47-25" id="__codelineno-47-25" name="__codelineno-47-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-47-26"><a href="#__codelineno-47-26" id="__codelineno-47-26" name="__codelineno-47-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-47-27"><a href="#__codelineno-47-27" id="__codelineno-47-27" name="__codelineno-47-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-47-28"><a href="#__codelineno-47-28" id="__codelineno-47-28" name="__codelineno-47-28"></a><span class="p">}</span>
</span><span id="__span-47-29"><a href="#__codelineno-47-29" id="__codelineno-47-29" name="__codelineno-47-29"></a>
</span><span id="__span-47-30"><a href="#__codelineno-47-30" id="__codelineno-47-30" name="__codelineno-47-30"></a><span class="c1">// Evaluation</span>
</span><span id="__span-47-31"><a href="#__codelineno-47-31" id="__codelineno-47-31" name="__codelineno-47-31"></a><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EnterpriseContext</span><span class="p">(</span>
</span><span id="__span-47-32"><a href="#__codelineno-47-32" id="__codelineno-47-32" name="__codelineno-47-32"></a><span class="w">    </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppLocale</span><span class="p">.</span><span class="na">EN_US</span><span class="p">,</span>
</span><span id="__span-47-33"><a href="#__codelineno-47-33" id="__codelineno-47-33" name="__codelineno-47-33"></a><span class="w">    </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Platform</span><span class="p">.</span><span class="na">WEB</span><span class="p">,</span>
</span><span id="__span-47-34"><a href="#__codelineno-47-34" id="__codelineno-47-34" name="__codelineno-47-34"></a><span class="w">    </span><span class="n">appVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Version</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">"1.0.0"</span><span class="p">),</span>
</span><span id="__span-47-35"><a href="#__codelineno-47-35" id="__codelineno-47-35" name="__codelineno-47-35"></a><span class="w">    </span><span class="n">stableId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StableId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">"user-123"</span><span class="p">),</span>
</span><span id="__span-47-36"><a href="#__codelineno-47-36" id="__codelineno-47-36" name="__codelineno-47-36"></a><span class="w">    </span><span class="n">subscriptionTier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SubscriptionTier</span><span class="p">.</span><span class="na">ENTERPRISE</span><span class="p">,</span>
</span><span id="__span-47-37"><a href="#__codelineno-47-37" id="__codelineno-47-37" name="__codelineno-47-37"></a><span class="w">    </span><span class="n">organizationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"acme-corp"</span>
</span><span id="__span-47-38"><a href="#__codelineno-47-38" id="__codelineno-47-38" name="__codelineno-47-38"></a><span class="p">)</span>
</span><span id="__span-47-39"><a href="#__codelineno-47-39" id="__codelineno-47-39" name="__codelineno-47-39"></a>
</span><span id="__span-47-40"><a href="#__codelineno-47-40" id="__codelineno-47-40" name="__codelineno-47-40"></a><span class="kd">val</span><span class="w"> </span><span class="nv">canExport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">evaluateOrDefault</span><span class="p">(</span><span class="n">PremiumFeatures</span><span class="p">.</span><span class="na">DATA_EXPORT</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="example-5-ab-testing">Example 5: A/B Testing<a class="headerlink" href="#example-5-ab-testing" title="Permanent link">¶</a></h3>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-48-1"><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">Experiments</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FeatureContainer</span><span class="o">&lt;</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Namespace</span><span class="p">.</span><span class="na">Global</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-2"><a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">RECOMMENDATION_ALGORITHM</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">string</span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"collaborative"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-3"><a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">        </span><span class="n">salt</span><span class="p">(</span><span class="s">"experiment-2024-01"</span><span class="p">)</span><span class="w">  </span><span class="c1">// Unique salt for this experiment</span>
</span><span id="__span-48-4"><a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a>
</span><span id="__span-48-5"><a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">        </span><span class="n">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-6"><a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="w">            </span><span class="n">rollout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rollout</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="m">50.0</span><span class="p">)</span><span class="w">  </span><span class="c1">// 50/50 split</span>
</span><span id="__span-48-7"><a href="#__codelineno-48-7" id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="w">            </span><span class="n">note</span><span class="p">(</span><span class="s">"A/B test: collaborative vs content-based recommendations"</span><span class="p">)</span>
</span><span id="__span-48-8"><a href="#__codelineno-48-8" id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="s">"content-based"</span>
</span><span id="__span-48-9"><a href="#__codelineno-48-9" id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-48-10"><a href="#__codelineno-48-10" id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="p">}</span>
</span><span id="__span-48-11"><a href="#__codelineno-48-11" id="__codelineno-48-11" name="__codelineno-48-11"></a>
</span><span id="__span-48-12"><a href="#__codelineno-48-12" id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="c1">// 50% of users get "collaborative" (default)</span>
</span><span id="__span-48-13"><a href="#__codelineno-48-13" id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="c1">// 50% of users get "content-based" (rule)</span>
</span><span id="__span-48-14"><a href="#__codelineno-48-14" id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="c1">// Assignment is stable per user across sessions</span>
</span></code></pre></div>
<hr/>
<h2 id="summary-evaluation-guarantees">Summary: Evaluation Guarantees<a class="headerlink" href="#summary-evaluation-guarantees" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Guarantee</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Type safety</strong></td>
<td>Return type matches flag definition, enforced at compile time</td>
</tr>
<tr>
<td><strong>Determinism</strong></td>
<td>Same inputs always produce same output</td>
</tr>
<tr>
<td><strong>Specificity</strong></td>
<td>Most specific matching rule always wins</td>
</tr>
<tr>
<td><strong>Bucketing</strong></td>
<td>SHA-256 ensures independent, stable buckets per flag</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>O(n) where n = rules per flag (typically &lt; 10)</td>
</tr>
<tr>
<td><strong>Thread safety</strong></td>
<td>Lock-free reads, immutable data</td>
</tr>
<tr>
<td><strong>Null safety</strong></td>
<td>Never returns null, default value guaranteed</td>
</tr>
</tbody>
</table>
<p><strong>Core Principle:</strong> Evaluation is deterministic, type-safe, and performant.</p>
<hr/>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<ul>
<li><strong><a href="../Results/">Results</a></strong> - Deep dive into EvaluationResult and error handling patterns</li>
<li><strong><a href="../Rules/">Rules</a></strong> - Master advanced targeting and custom evaluables</li>
<li><strong><a href="../Context/">Context</a></strong> - Design custom contexts for business logic</li>
<li><strong><a href="../Configuration/">Configuration</a></strong> - Complete DSL reference</li>
<li><strong><a href="../Registry/">Registry</a></strong> - Namespace and concurrency management</li>
<li><strong><a href="../">Overview</a></strong> - Back to API overview</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/amichne/konditional" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>