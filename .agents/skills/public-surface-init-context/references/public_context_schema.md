# Public surface context schema

Use this schema as the stable contract for
`scripts/build_public_surface_context.py`.

## Scope

- Consume `INDEX.sig` and referenced `.sig` files generated by
  `llm-native-signature-spec`.
- Emit a deterministic context that represents only public API shape.
- Exclude non-public declarations from the output.
- Include only primary source sets by default:
  - `src/main`
  - `src/commonMain`
  - `src/jvmMain`
  - `src/jsMain`
  - `src/nativeMain`
- Allow optional expansion to non-primary sources via
  `--include-non-primary-sources`.
- Exclude internal package/location markers:
  - package contains `.internal.` or ends with `.internal`
  - source path contains `/internal/`

## Visibility rules

- Reject declarations containing `private`, `protected`, or `internal`.
- For Kotlin (`.kt`, `.kts`):
  - Treat declarations without explicit visibility as public.
- For Java/Scala (`.java`, `.scala`):
  - Require explicit `public`.
  - Treat package-private as non-public.

## Output document

The output is a line-oriented key-value artifact:

```text
context=public-surface-init
version=1
scope=public-surface-only
repository=<repo-name>
source_signatures_dir=<signatures-path>
public_type_count=<N>

modules:
- module=<name>|public_types=<N>

types:
- type=<fqcn>|kind=<kind>|file=<source-file>|package=<package>|decl=<normalized-declaration>

file_members:
- file=<source-file>|public_methods=<N>|public_fields=<N>
  method=<normalized-signature>
  field=<normalized-signature>
  method_truncated=<N>
  field_truncated=<N>
```

## Determinism constraints

- Sort all sections lexicographically where applicable.
- Normalize whitespace in declarations/signatures.
- Deduplicate while preserving first-seen order within each file.
- Emit no timestamps, random IDs, or environment-dependent fields.
