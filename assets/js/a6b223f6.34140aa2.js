"use strict";(self.webpackChunkkonditional_docs=self.webpackChunkkonditional_docs||[]).push([[67],{6648(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"targeting-ramp-ups","title":"Targeting & Ramp-ups","description":"Rules let you target specific contexts and ramp up behavior safely. A rule is a typed mapping:","source":"@site/docs/targeting-ramp-ups.md","sourceDirName":".","slug":"/targeting-ramp-ups","permalink":"/konditional/targeting-ramp-ups","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Core Concepts","permalink":"/konditional/core-concepts"},"next":{"title":"Evaluation","permalink":"/konditional/evaluation"}}');var l=i(86070),t=i(48193);const a={},r="Targeting & Ramp-ups",o={},c=[{value:"Criteria you can combine",id:"criteria-you-can-combine",level:2},{value:"Platform",id:"platform",level:3},{value:"Locale",id:"locale",level:3},{value:"Axis (custom dimensions)",id:"axis-custom-dimensions",level:3},{value:"Version ranges",id:"version-ranges",level:3},{value:"Percentage ramp-up",id:"percentage-ramp-up",level:3},{value:"Ramp-up allowlisting (internal testers)",id:"ramp-up-allowlisting-internal-testers",level:3},{value:"Custom predicates via <code>extension { }</code>",id:"custom-predicates-via-extension--",level:3},{value:"AND semantics inside a rule",id:"and-semantics-inside-a-rule",level:2},{value:"Specificity: which rule wins",id:"specificity-which-rule-wins",level:2},{value:"Deterministic ramp-up bucketing (SHA-256)",id:"deterministic-ramp-up-bucketing-sha-256",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"targeting--ramp-ups",children:"Targeting & Ramp-ups"})}),"\n",(0,l.jsx)(n.p,{children:"Rules let you target specific contexts and ramp up behavior safely. A rule is a typed mapping:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"criteria(context) -> value\n"})}),"\n",(0,l.jsx)(n.p,{children:"Two properties define how rules behave:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"AND semantics within a rule"}),": all specified criteria must match."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Specificity ordering across rules"}),": the most specific matching rule wins."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"criteria-you-can-combine",children:"Criteria you can combine"}),"\n",(0,l.jsx)(n.h3,{id:"platform",children:"Platform"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'val apiEndpoint by string<Context>(default = "https://api.example.com") {\n    rule("https://api-ios.example.com") { platforms(Platform.IOS) }\n    rule("https://api-android.example.com") { platforms(Platform.ANDROID) }\n    rule("https://api-web.example.com") { platforms(Platform.WEB) }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Multiple platforms combine as OR:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'rule("mobile value") { platforms(Platform.IOS, Platform.ANDROID) }\n'})}),"\n",(0,l.jsx)(n.h3,{id:"locale",children:"Locale"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'val welcomeMessage by string<Context>(default = "Hello!") {\n    rule("Welcome!") { locales(AppLocale.UNITED_STATES, AppLocale.CANADA) }\n    rule("Bienvenue!") { locales(AppLocale.FRANCE) }\n    rule("\u3088\u3046\u3053\u305d!") { locales(AppLocale.JAPAN) }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"axis-custom-dimensions",children:"Axis (custom dimensions)"}),"\n",(0,l.jsx)(n.p,{children:"Axis values let you target custom dimensions (environment, tenant, region, etc.):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'enum class Environment(override val id: String) : AxisValue<Environment> {\n    PROD("prod"),\n    STAGE("stage"),\n    DEV("dev"),\n}\n\nobject Axes {\n    object Environment : Axis<Environment>("environment", Environment::class)\n}\n\nval newUi by boolean<Context>(default = false) {\n    rule(true) { axis(Environment.PROD) }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Axis ids are serialized into configuration snapshots. Keep them stable and explicit; avoid relying on implicit ids\nderived from class names if you use code shrinking/obfuscation."}),"\n",(0,l.jsx)(n.h3,{id:"version-ranges",children:"Version ranges"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val newUi by boolean<Context>(default = false) {\n    rule(true) { versions { min(2, 0, 0) } }\n}\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val legacySupport by boolean<Context>(default = false) {\n    rule(true) { versions { max(2, 0, 0) } }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"percentage-ramp-up",children:"Percentage ramp-up"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val newCheckout by boolean<Context>(default = false) {\n    rule(true) { rampUp { 10.0 } }\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Ramp-ups are deterministic: the same ",(0,l.jsx)(n.code,{children:"(stableId, flagKey, salt)"})," produces the same bucket assignment."]}),"\n",(0,l.jsx)(n.h3,{id:"ramp-up-allowlisting-internal-testers",children:"Ramp-up allowlisting (internal testers)"}),"\n",(0,l.jsxs)(n.p,{children:["Allowlists bypass ramp-up ",(0,l.jsx)(n.em,{children:"after"})," a rule matches by criteria:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'val newUi by boolean<Context>(default = false) {\n    allowlist(StableId.of("tester-1")) // flag-scope allowlist\n    rule(true) { rampUp { 5.0 } }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Rule-scoped allowlists are also supported:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'rule(true) {\n    rampUp { 5.0 }\n    allowlist(StableId.of("tester-1"))\n}\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"custom-predicates-via-extension--",children:["Custom predicates via ",(0,l.jsx)(n.code,{children:"extension { }"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val ADVANCED_ANALYTICS by boolean<EnterpriseContext>(default = false) {\n    rule(true) {\n        extension { subscriptionTier == SubscriptionTier.ENTERPRISE && employeeCount > 100 }\n    }\n}\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"and-semantics-inside-a-rule",children:"AND semantics inside a rule"}),"\n",(0,l.jsx)(n.p,{children:"All criteria in a rule must match:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val premiumFeature by boolean<Context>(default = false) {\n    rule(true) {\n        platforms(Platform.IOS, Platform.ANDROID)\n        locales(AppLocale.UNITED_STATES)\n        versions { min(2, 0, 0) }\n        rampUp { 50.0 }\n    }\n}\n"})}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart TD\n  Ctx["Context"] --\x3e P{Platform match?}\n  P --\x3e|No| Skip["Rule fails"]\n  P --\x3e|Yes| L{Locale match?}\n  L --\x3e|No| Skip\n  L --\x3e|Yes| V{Version match?}\n  V --\x3e|No| Skip\n  V --\x3e|Yes| R{Ramp-up bucket in range?}\n  R --\x3e|No| Skip\n  R --\x3e|Yes| Win["Rule matches"]\n  style Win fill:#c8e6c9\n  style Skip fill:#ffcdd2'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"specificity-which-rule-wins",children:"Specificity: which rule wins"}),"\n",(0,l.jsxs)(n.p,{children:["Konditional orders rules by ",(0,l.jsx)(n.strong,{children:"specificity"})," before evaluating them. Specificity is the count of criteria present on a\nrule:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"specificity(rule):\n  +1 if platforms is set\n  +1 if locales is set\n  +1 if versions has bounds\n  +N for axis constraints (one per axis)\n  +extensionSpecificity (defaults to 1 when `extension { ... }` is used)\n"})}),"\n",(0,l.jsx)(n.p,{children:"Rules are evaluated in descending specificity; the first rule whose criteria all match determines the value. If no rules\nmatch, the default is returned."}),"\n",(0,l.jsx)(n.p,{children:"If multiple rules have the same specificity, their original insertion order is used as the tie-breaker."}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart TD\n  Rules["Rule set"] --\x3e Sort["Sort by specificity (desc)"]\n  Sort --\x3e Loop["Evaluate rules in order"]\n  Loop --\x3e|First match| Value["Return rule value"]\n  Loop --\x3e|No match| Default["Return default"]\n  style Value fill:#c8e6c9\n  style Default fill:#fff3cd'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"deterministic-ramp-up-bucketing-sha-256",children:"Deterministic ramp-up bucketing (SHA-256)"}),"\n",(0,l.jsx)(n.p,{children:"Ramp-ups are computed locally. The bucketing input is stable and per-flag:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:'input = "$salt:$flagKey:${stableIdHex}"\nhash = sha256(input)\nbucket = uint32(hash[0..3]) % 10_000 // [0, 10_000)\n'})}),"\n",(0,l.jsx)(n.p,{children:"This yields three operational properties:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deterministic"}),": same inputs \u2192 same bucket"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Per-flag isolation"}),": changing one flag does not affect other flags\u2019 buckets"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Salt-controlled redistribution"}),": changing ",(0,l.jsx)(n.code,{children:"salt"})," re-buckets users for that flag"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Ramp-up checks are performed in basis points:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"thresholdBasisPoints = round(rampUpPercent * 100) // 0..10_000\ninRampUp = bucket < thresholdBasisPoints\n"})}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart TD\n  Salt["salt"] --\x3e In["salt:flagKey:stableIdHex"]\n  Key["flagKey"] --\x3e In\n  Id["stableIdHex"] --\x3e In\n  In --\x3e H["SHA-256"]\n  H --\x3e M["uint32(hash[0..3]) mod 10,000"]\n  M --\x3e T{"bucket < rampUpBasisPoints ?"}\n  T --\x3e|Yes| Enabled["In ramp-up"]\n  T --\x3e|No| Disabled["Out of ramp-up"]\n  style Enabled fill:#c8e6c9\n  style Disabled fill:#ffcdd2'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Understand evaluation flow and performance: ",(0,l.jsx)(n.a,{href:"/evaluation",children:'"Evaluation"'})]}),"\n",(0,l.jsxs)(n.li,{children:["Understand the compile-time vs runtime boundary: ",(0,l.jsx)(n.a,{href:"/theory",children:'"Theory"'})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},48193(e,n,i){i.d(n,{R:()=>a,x:()=>r});var s=i(30758);const l={},t=s.createContext(l);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);